
function toNum(v){return Number(v||0);}let lang='en';const T={en:{title:'Melting Pro 2.1 - Aarav Steel Tech',subtitle:'Offline furnace calculators',select:'Select Calculator',opt1:'Si-Mn Required (target Mn%)',opt2:'Mn Recovery (%)',opt3:'FeO from Fe(M)',opt4:'Carbon Adjustment (Up / Down)',calc:'Calculate',reset:'Reset',sponge_label:'Sponge Iron (FeO %)',cast_label:'Cast / Carburizer (C %)'},hi:{title:'Melting Pro 2.1 - आरव स्टील टेक',subtitle:'ऑफ़लाइन फर्नेस कैलकुलेटर',select:'कैलकुलेटर चुनें',opt1:'Si-Mn आवश्यक (लक्षित Mn%)',opt2:'Mn रीकवरी (%)',opt3:'Fe(M) से FeO',opt4:'कार्बन समायोजन (ऊपर/नीचे)',calc:'गणना करें',reset:'रीसेट',sponge_label:'स्पॉन्ज आयरन (FeO %)',cast_label:'कास्ट/कार्ब्यूराइज़र (C %)'}};function t(k){return T[lang][k]||k;}function renderUI(){document.getElementById('title').textContent=t('title');document.getElementById('subtitle').textContent=t('subtitle');document.getElementById('selLabel').textContent=t('select');document.getElementById('opt1').textContent=t('opt1');document.getElementById('opt2').textContent=t('opt2');document.getElementById('opt3').textContent=t('opt3');document.getElementById('opt4').textContent=t('opt4');document.getElementById('calcBtn').textContent=t('calc');document.getElementById('resetBtn').textContent=t('reset');document.getElementById('langBtn').textContent=(lang==='en')?'हिंदी':'EN';document.getElementById('matLabel').textContent=(document.getElementById('c_mat').value==='sponge')?t('sponge_label'):t('cast_label');}function init(){document.getElementById('langBtn').addEventListener('click',()=>{lang=(lang==='en')?'hi':'en';renderUI();});document.getElementById('calculator').addEventListener('change',()=>{switchUI();renderUI();});document.getElementById('calcBtn').addEventListener('click',doCalc);document.getElementById('resetBtn').addEventListener('click',resetAll);document.getElementById('c_mat').addEventListener('change',renderUI);renderUI();switchUI();if('serviceWorker' in navigator){navigator.serviceWorker.register('service-worker.js').catch(()=>{});}}function switchUI(){const v=document.getElementById('calculator').value;document.querySelectorAll('.calc-section').forEach(s=>s.style.display='none');if(v==='1')document.getElementById('sec1').style.display='block';if(v==='2')document.getElementById('sec2').style.display='block';if(v==='3')document.getElementById('sec3').style.display='block';if(v==='4')document.getElementById('sec4').style.display='block';document.getElementById('allRes').textContent='';}function calcSiMnRequired(){const heat=toNum(document.getElementById('heatKg').value);const cur=toNum(document.getElementById('curMn').value);const target=toNum(document.getElementById('targetMn').value);const alloy=toNum(document.getElementById('alloyMn').value);const rec=toNum(document.getElementById('recMn').value);if(heat<=0||alloy<=0||rec<=0)return{err:'Enter positive values'};const x=(target-cur)*heat*100.0/(alloy*rec);return{kg:x}}function calcMnRecovery(){const metal=toNum(document.getElementById('rec_metalKg').value);const mnMetal=toNum(document.getElementById('rec_mnMetal').value);const alloyW=toNum(document.getElementById('rec_alloyKg').value);const mnAlloy=toNum(document.getElementById('rec_mnAlloy').value);if(metal<=0||alloyW<=0||mnAlloy<=0)return{err:'Enter positive values'};const recovery=(metal*(mnMetal/100.0))/(alloyW*(mnAlloy/100.0))*100.0;return{recovery:recovery}}function calcFeOfromFeM(){const fetot=toNum(document.getElementById('fe_tot').value);const fem=toNum(document.getElementById('fe_m').value);if(fetot<=fem)return{err:'Fe total must be greater than Fe(M)'};const feo=(fetot-fem)/0.777;return{feo:feo}}function calcCarbonAdjust(){const metalKg=toNum(document.getElementById('c_metalKg').value);const curC=toNum(document.getElementById('c_cur').value);const targetC=toNum(document.getElementById('c_target').value);const matType=document.getElementById('c_mat').value;const matPct=toNum(document.getElementById('c_matPct').value);if(metalKg<=0||matPct<=0)return{err:'Enter positive metal mass and material %'};if(matType==='sponge'){const drop=curC-targetC;if(drop<=0)return{err:'Target must be lower than current for sponge'};const metalTon=metalKg/1000.0;const spongeKg=(drop*metalTon)/(0.1*matPct);return{spongeKg:spongeKg}}else{const delta=targetC-curC;if(delta<=0)return{err:'Target must be higher than current for cast/carburizer'};const addKg=(metalKg*delta)/matPct;return{addKg:addKg}}}function doCalc(){const sel=document.getElementById('calculator').value;let res;if(sel==='1')res=calcSiMnRequired();if(sel==='2')res=calcMnRecovery();if(sel==='3')res=calcFeOfromFeM();if(sel==='4')res=calcCarbonAdjust();const out=document.getElementById('allRes');if(!res){out.textContent='Calculation error';return}if(res.err){out.textContent=res.err;return}if(res.kg!==undefined)out.innerHTML='<strong>Result:</strong> Add '+res.kg.toFixed(2)+' kg of Si-Mn (approx).';else if(res.recovery!==undefined)out.innerHTML='<strong>Result:</strong> Mn Recovery ≈ '+res.recovery.toFixed(2)+' %';else if(res.feo!==undefined)out.innerHTML='<strong>Result:</strong> Estimated FeO ≈ '+res.feo.toFixed(2)+' %';else if(res.spongeKg!==undefined)out.innerHTML='<strong>Result:</strong> Add '+res.spongeKg.toFixed(1)+' kg sponge (approx).';else if(res.addKg!==undefined)out.innerHTML='<strong>Result:</strong> Add '+res.addKg.toFixed(1)+' kg carburizer/cast (approx).';else out.textContent=JSON.stringify(res)}function resetAll(){document.querySelectorAll('input').forEach(i=>i.value='');document.getElementById('allRes').textContent='';}document.addEventListener('DOMContentLoaded',init);